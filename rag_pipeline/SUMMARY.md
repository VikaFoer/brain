# –ü—ñ–¥—Å—É–º–æ–∫: Production-Ready RAG Pipeline

## ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑ —á—ñ—Ç–∫–∏–º —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è–º –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ
- ‚úÖ CLI —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ—Ç–∞–ø—É –ø–∞–π–ø–ª–∞–π–Ω—É
- ‚úÖ –¢–µ—Å—Ç–∏ –¥–ª—è –∫–ª—é—á–æ–≤–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
- ‚úÖ SQL –º—ñ–≥—Ä–∞—Ü—ñ—ó –¥–ª—è pgvector

### 2. Ingestion (–ï–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è)
- ‚úÖ –ü–∞—Ä—Å–µ—Ä–∏ –¥–ª—è PDF, HTML, DOCX, TXT
- ‚úÖ –î–µ—Ç–µ–∫—Ü—ñ—è —Å–∫–∞–Ω—ñ–≤ (needs_ocr)
- ‚úÖ –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ —á–µ—Ä–µ–∑ ThreadPoolExecutor
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö doc_id

### 3. Cleaning (–û—á–∏—Å—Ç–∫–∞)
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤ —Å—Ç–æ—Ä—ñ–Ω–æ–∫
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª—ñ–≤
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤
- ‚úÖ –í–∏—Ç—è–≥ –¥–æ–≤—ñ–¥–∫–æ–≤–æ–≥–æ –±–ª–æ–∫—É –≤ metadata

### 4. Chunking (–†–æ–∑–±–∏—Ç—Ç—è)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏–π —á–∞–Ω–∫—ñ–Ω–≥: –†–æ–∑–¥—ñ–ª ‚Üí –°—Ç–∞—Ç—Ç—è ‚Üí –ß–∞—Å—Ç–∏–Ω–∞ ‚Üí –ü—É–Ω–∫—Ç
- ‚úÖ Overlap 10-15% –º—ñ–∂ —á–∞–Ω–∫–∞–º–∏
- ‚úÖ –†–æ–∑–±–∏—Ç—Ç—è –≤–µ–ª–∏–∫–∏—Ö —á–∞–Ω–∫—ñ–≤ –ø–æ —Ä–µ—á–µ–Ω–Ω—è—Ö
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è section_path –≤ metadata
- ‚úÖ –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Ç–æ–∫–µ–Ω—ñ–≤ —á–µ—Ä–µ–∑ tiktoken

### 5. Embeddings
- ‚úÖ OpenAI text-embedding-3-large
- ‚úÖ Batch API –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó ($0.065 vs $0.13)
- ‚úÖ Rate limiting (60 RPM)
- ‚úÖ Retry –∑ exponential backoff
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä–∏

### 6. Storage
- ‚úÖ PostgreSQL + pgvector —Å—Ö–µ–º–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü—ñ: documents, chunks
- ‚úÖ –Ü–Ω–¥–µ–∫—Å–∏: ivfflat –¥–ª—è ANN, GIN –¥–ª—è section_path
- ‚úÖ Idempotent inserts (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ chunk_id)
- ‚úÖ Batch inserts –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### 7. Retrieval
- ‚úÖ Semantic search —á–µ—Ä–µ–∑ cosine similarity
- ‚úÖ TopK –ø–æ—à—É–∫
- ‚úÖ –§—ñ–ª—å—Ç—Ä–∏ –ø–æ doc_id, section_path
- ‚úÖ Similarity threshold

### 8. CLI –°–∫—Ä–∏–ø—Ç–∏
- ‚úÖ `extract_text` - –µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è –∑ —Ñ–∞–π–ª—ñ–≤
- ‚úÖ `chunk_documents` - —á–∞–Ω–∫—ñ–Ω–≥
- ‚úÖ `embed_chunks` - embeddings + –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- ‚úÖ `search` - –ø–æ—à—É–∫

### 9. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- ‚úÖ Pydantic Settings
- ‚úÖ Structured logging (JSON)
- ‚úÖ Environment variables

### 10. –¢–µ—Å—Ç–∏
- ‚úÖ Unit-—Ç–µ—Å—Ç–∏ –¥–ª—è chunking
- ‚úÖ Unit-—Ç–µ—Å—Ç–∏ –¥–ª—è cleaning
- ‚úÖ –ú–æ–∫–∏ –¥–ª—è embeddings

## üìä –ú–µ—Ç–∞–¥–∞–Ω—ñ

–í—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è:
- ‚úÖ doc_id
- ‚úÖ title
- ‚úÖ act_number
- ‚úÖ date
- ‚úÖ authority
- ‚úÖ url/source
- ‚úÖ section_path (–†–æ–∑–¥—ñ–ª ‚Üí –°—Ç–∞—Ç—Ç—è ‚Üí –ß–∞—Å—Ç–∏–Ω–∞ ‚Üí –ü—É–Ω–∫—Ç)
- ‚úÖ chunk_index
- ‚úÖ char_start/char_end
- ‚úÖ tokens

## üöÄ –ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É

```bash
# 1. –ï–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è
python -m scripts.extract_text --input data/raw --output data/docs.jsonl

# 2. –ß–∞–Ω–∫—ñ–Ω–≥
python -m scripts.chunk_documents --input data/docs.jsonl --output data/chunks.jsonl

# 3. Embeddings + –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
python -m scripts.embed_chunks --input data/chunks.jsonl

# 4. –ü–æ—à—É–∫
python -m scripts.search --query "–ø—Ä–∞–≤–∞ –ª—é–¥–∏–Ω–∏" --topk 10
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
rag_pipeline/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ ingestion/      ‚úÖ extractors.py, processor.py
‚îÇ   ‚îú‚îÄ‚îÄ cleaning/        ‚úÖ cleaner.py
‚îÇ   ‚îú‚îÄ‚îÄ chunking/        ‚úÖ splitter.py
‚îÇ   ‚îú‚îÄ‚îÄ embeddings/      ‚úÖ generator.py
‚îÇ   ‚îú‚îÄ‚îÄ storage/         ‚úÖ dao.py
‚îÇ   ‚îú‚îÄ‚îÄ retrieval/       ‚úÖ searcher.py
‚îÇ   ‚îî‚îÄ‚îÄ utils/           ‚úÖ config.py, logger.py, retry.py
‚îú‚îÄ‚îÄ scripts/             ‚úÖ extract_text.py, chunk_documents.py, embed_chunks.py, search.py
‚îú‚îÄ‚îÄ migrations/          ‚úÖ 001_init_pgvector.sql
‚îú‚îÄ‚îÄ tests/               ‚úÖ test_chunking.py, test_cleaning.py, test_embeddings.py
‚îú‚îÄ‚îÄ requirements.txt     ‚úÖ –í—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ README.md            ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ QUICK_START.md       ‚úÖ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç
‚îî‚îÄ‚îÄ ARCHITECTURE.md      ‚úÖ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
```

## üéØ –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–ü–∞–π–ø–ª–∞–π–Ω –ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ –æ–±—Ä–æ–±–∫–∏ 168,000 –ù–ü–ê:
- –ú–æ–¥—É–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- Production-ready –∫–æ–¥
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
- –¢–µ—Å—Ç–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

## üîß –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

1. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ `.env` –∑ OPENAI_API_KEY —Ç–∞ DATABASE_URL
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é
3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω –Ω–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
4. –ú–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ –Ω–∞ –ø–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

