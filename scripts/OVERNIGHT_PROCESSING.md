# üåô –ù—ñ—á–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –≤—Å—ñ—Ö –ù–ü–ê

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –æ–±—Ä–æ–±–∫–∏ **–≤—Å—ñ—Ö** –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤–∏—Ö –∞–∫—Ç—ñ–≤ –∑ Rada API –∑–∞ –Ω—ñ—á.

## üìã –û–ø–∏—Å

–°–∫—Ä–∏–ø—Ç `process_all_npa_overnight.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –ù–ü–ê –∑ Rada API –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö
2. ‚úÖ –û–±—Ä–æ–±–ª—è—î –≤—Å—ñ –Ω–µ–æ–±—Ä–æ–±–ª–µ–Ω—ñ –ù–ü–ê –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
3. ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞—î –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω—ñ –∞–∫—Ç–∏
4. ‚úÖ –õ–æ–≥—É—î –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å —É —Ñ–∞–π–ª `overnight_processing.log`
5. ‚úÖ –ü–æ–∫–∞–∑—É—î –ø—Ä–æ–≥—Ä–µ—Å –∑ progress bar
6. ‚úÖ –í–∏–≤–æ–¥–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

## üöÄ –ó–∞–ø—É—Å–∫

### –í—Ä—É—á–Ω—É

**Linux/Mac:**
```bash
chmod +x scripts/run_overnight.sh
./scripts/run_overnight.sh
```

**Windows:**
```powershell
.\scripts\run_overnight.ps1
```

**–ê–±–æ –Ω–∞–ø—Ä—è–º—É:**
```bash
python scripts/process_all_npa_overnight.py
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ cron (Linux/Mac)

–î–æ–¥–∞–π—Ç–µ –≤ crontab –¥–ª—è –∑–∞–ø—É—Å–∫—É —â–æ–¥–Ω—è –æ 2:00 –Ω–æ—á—ñ:

```bash
crontab -e
```

–î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫:
```
0 2 * * * cd /path/to/brain && python scripts/process_all_npa_overnight.py >> overnight_cron.log 2>&1
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ Task Scheduler (Windows)

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ "–ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –∑–∞–≤–¥–∞–Ω—å" (Task Scheduler)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è
3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ:
   - **–¢—Ä–∏–≥–µ—Ä:** –©–æ–¥–Ω—è –æ 2:00
   - **–î—ñ—è:** –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–∏
   - **–ü—Ä–æ–≥—Ä–∞–º–∞:** `python`
   - **–ê—Ä–≥—É–º–µ–Ω—Ç–∏:** `scripts\process_all_npa_overnight.py`
   - **–†–æ–±–æ—á–∞ –ø–∞–ø–∫–∞:** `D:\BRAIN` (–∞–±–æ –≤–∞—à–∞ –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç—É)

### –ù–∞ Railway (—á–µ—Ä–µ–∑ API endpoint)

–ú–æ–∂–Ω–∞ —Ç–∞–∫–æ–∂ —Å—Ç–≤–æ—Ä–∏—Ç–∏ endpoint –¥–ª—è –∑–∞–ø—É—Å–∫—É —á–µ—Ä–µ–∑ API:

```python
@router.post("/process-all-overnight")
async def start_overnight_processing(background_tasks: BackgroundTasks):
    # –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ
    ...
```

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–£ —Ñ–∞–π–ª—ñ `process_all_npa_overnight.py` –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏:

```python
await processor.process_all_acts(
    batch_size=10,              # –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∞–∫—Ç—ñ–≤ –≤ –æ–¥–Ω–æ–º—É –±–∞—Ç—á—ñ
    delay_between_batches=5.0   # –ó–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –±–∞—Ç—á–∞–º–∏ (—Å–µ–∫—É–Ω–¥–∏)
)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- `batch_size=10` - –æ–±—Ä–æ–±–ª—è—î –ø–æ 10 –∞–∫—Ç—ñ–≤ –∑–∞ —Ä–∞–∑ (–¥–ª—è rate limiting)
- `delay_between_batches=5.0` - –∑–∞—Ç—Ä–∏–º–∫–∞ 5 —Å–µ–∫—É–Ω–¥ –º—ñ–∂ –±–∞—Ç—á–∞–º–∏
- –î–ª—è —à–≤–∏–¥—à–æ—ó –æ–±—Ä–æ–±–∫–∏ –º–æ–∂–Ω–∞ –∑–±—ñ–ª—å—à–∏—Ç–∏ `batch_size` –¥–æ 20-30
- –î–ª—è –±—ñ–ª—å—à –æ–±–µ—Ä–µ–∂–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –∑–º–µ–Ω—à–∏—Ç–∏ –¥–æ 5

## üìä –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä—é—î —Ñ–∞–π–ª `overnight_processing.log` –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –ª–æ–≥–æ–º:
- –ö–æ–∂–µ–Ω –æ–±—Ä–æ–±–ª–µ–Ω–∏–π –∞–∫—Ç
- –ü–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–æ–±–∫–∏

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç –≤–∏–≤–æ–¥–∏—Ç—å:
- ‚è±Ô∏è –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- üìã –í—Å—å–æ–≥–æ –∑–Ω–∞–π–¥–µ–Ω–æ –ù–ü–ê
- ‚úÖ –£—Å–ø—ñ—à–Ω–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ
- ‚è≠Ô∏è –í–∂–µ –±—É–ª–∏ –æ–±—Ä–æ–±–ª–µ–Ω—ñ
- ‚ùå –ü–æ–º–∏–ª–æ–∫
- üìä –í—ñ–¥—Å–æ—Ç–æ–∫ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ

## üîí –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—î –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω—ñ –∞–∫—Ç–∏
- ‚úÖ –ù–µ —Å—Ç–≤–æ—Ä—é—î –¥—É–±–ª—ñ–∫–∞—Ç–∏
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î rate limiting –¥–ª—è Rada API
- ‚úÖ –û–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î —Ä–æ–±–æ—Ç—É
- ‚úÖ –ö–æ–º—ñ—Ç–∏—Ç—å –∑–º—ñ–Ω–∏ –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –∞–∫—Ç—É

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

1. **–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞** (PostgreSQL –Ω–∞ Railway)
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ OpenAI API key –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π** –¥–ª—è –æ–±—Ä–æ–±–∫–∏
3. **–°–∫—Ä–∏–ø—Ç –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–∞–≥–∞—Ç–æ –≥–æ–¥–∏–Ω** –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ù–ü–ê
4. **–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º—ñ—Å—Ü—è –Ω–∞ –¥–∏—Å–∫—É** –¥–ª—è –ª–æ–≥—ñ–≤

## üêõ –£—Å—É–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

**–ü–æ–º–∏–ª–∫–∞: "Database not connected"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `DATABASE_URL` –≤ –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è

**–ü–æ–º–∏–ª–∫–∞: "OpenAI API key not found"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `OPENAI_API_KEY` –≤ –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è

**–°–∫—Ä–∏–ø—Ç –∑–∞–≤–∏—Å–∞—î**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –≤ `overnight_processing.log`
- –ú–æ–∂–ª–∏–≤–æ, –ø—Ä–æ–±–ª–µ–º–∞ –∑ –º–µ—Ä–µ–∂–µ—é –∞–±–æ API

**–î—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–æ**
- –ó–±—ñ–ª—å—à—Ç–µ `batch_size` (–∞–ª–µ –Ω–µ –±—ñ–ª—å—à–µ 30)
- –ó–º–µ–Ω—à—Ç–µ `delay_between_batches`

